{% extends 'base.html' %}


{% block nav %}
    <br>
      <div style="font-size: large">
        <ol class="breadcrumb" style="background-color: transparent">
            <li><a href="/"><strong>Home</strong></a></li>
            <li><a href="/construct" style="color: #afd9ee"><strong>Construct</strong></a></li>
            <li><a href="/construct/insert" style="color: #afd9ee"><strong>Insert Attack</strong></a></li>
        </ol>
      </div>
{% endblock %}
<!-- 需要制造一个可以选择攻击的部分？ -->
{% block construct_insert %}
    <!-- 这里面是自己发挥的内容哦 -->
    <!-- 新 Bootstrap 核心 CSS 文件 -->

    <!-- 总而言之，想要好看，还是需要自己慢慢设计实现的 -->
    <!-- 直接用模板总会出现意想不到的问题 -->

    <!-- 算是自己实现了一个简陋的攻击生成页面，解决了一些必要的冲突 -->
    <!-- form提交以后，我们需要更新网页，将攻击内容显示出来 -->
    <!-- 我裂开，为什么jquery无法使用呢？貌似存在冲突？ -->
    <form role="form">
        {% csrf_token %}
        <div class="form-group" id="insert id">
        <!-- 之所以不显示，是因为这里的表单发生了冲突，并且冲突无法解决 -->
        <label>选择注入的报文id</label>
            <br/>
                <label>
                <select style="color:white;background-color: transparent;"
                    id="chose_id">
                    {% for item in targetChoics %}
                        <option style="color:black">{{ item }}</option>
                    {% endfor %}
                </select>
            </label>
        </div>

        <div class="form-group">
            <label for="name">攻击持续时间（s）</label><br/>
            <input type="text" id="attack_exist_time"
                style="color:white;background-color: transparent;" >
        </div>
        <!-- 这里涉及到了攻击的注入，只要把这个写好，总是可以飞黄腾达的 -->
        <br/>
        <button type="button" class="btn btn-default"
            style="color:white;background-color: transparent;font-size:12px"
                id="make_insert_attack">生成攻击</button>
    </form>

    <div class="container" id="attack_description_div">
          <ul class="list-group" id="attack_description">

                <!--
                {% for item in Description %}
                    <li class="list-group-item">{{ item }}</li>
                {% endfor %}
                -->
          </ul>
    </div>


    <!-- 以前的我是万万看不明白这个jquery ajax的写法的，现在水平确实比以前要高不少了 -->
    <script src="/static/js/jquery-3.5.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/slick.js"></script>
    <script src="/static/js/templatemo-script.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/npm.js"></script>
    <script>
        // 经过一系列复杂操作，终于获得了正确的html js响应，但是还需要一些美化操作，现在的界面太挫了
        // 美化操作应当如何快速完成呢？暂时是不清楚的
        $(function() {
            $("#make_insert_attack").click(function() {
                var formdata = new FormData();
                formdata.append("chose_id", $("#chose_id").val());
                formdata.append("attack_exist_time", $("#attack_exist_time").val());
                var token_of_csrf = $('[name="csrfmiddlewaretoken"]').val();
                formdata.append("csrfmiddlewaretoken", token_of_csrf);
                // 发现是undefined的，需要找到对应的真实内容？
                // console.log(token_of_csrf);
                // 总算是把数据成功发送过去了，我真的是醉了哦
                $.ajax({
                    url:"/process",
                    headers: {
                        "X-CSRFToken":token_of_csrf
                    },
                    type:"post",
                    data: formdata,
                    dataType: 'JSON',
                    cache:false,
                    processData:false,
                    contentType:false,
                    success:function(target_list) {
                        var n = target_list['size'];
                        n = parseInt(n);
                        //console.log(target_list);
                        for(var i=0; i<n; i++) {
                            var tmp = "<li class=\"list-group-item\" style=\"color:black \">";
                            var loc = toString(i);
                            //console.log(loc);
                            var content = target_list[i];
                            //console.log(content);
                            var tail = "</li>";
                            tmp = tmp + content + tail;
                            $('#attack_description_div').append(tmp);
                        }
                    }
                })
            })
        })
    </script>

{% endblock %}